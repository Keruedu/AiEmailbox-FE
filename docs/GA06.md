# AI Email Box - React Email Client with Gmail Integration & Kanban Workflow

A modern, secure email dashboard application that integrates with **Gmail API** (Track A) to provide a real-time email experience with **Kanban-style workflow management**. Built with **Go (Gin)** backend and **Next.js** frontend, featuring AI-powered email summarization and advanced search capabilities.


## Team
- Mai Xuân Quý (22120303)
- Lê Hoàng Việt (22120430)
- Trương Lê Anh Vũ (22120443)

## Deployed Public URLs

- **Frontend**: https://ai-emailbox-fe.vercel.app
- **Backend**: https://aiemailbox-be-go.onrender.com

## Project Overview

This project extends the **"React Email Client with Gmail / IMAP/POP3 Integration"** (Track A) with advanced workflow management and search features:

### Core Features (Week 1 - Track A)

- Google Cloud Project with Gmail API enabled
- OAuth2 Authentication with auto-refresh tokens
- Real-time email synchronization from Gmail
- Email list with pagination, unread/starred indicators
- Email detail view with HTML rendering and attachments
- Compose and send emails

### Kanban Workflow Features (Week 2 - GA5)

- Kanban Board Interface with visual columns (Inbox, To Do, In Progress, Done, Snoozed)
- Drag-and-Drop workflow management
- Snooze/Deferral mechanism with automatic restoration
- AI Content Summarization with toggle view
- List/Kanban view toggle

### Advanced Search & UX Features (Week 3 - GA6)

- **Fuzzy Search Engine**: Typo-tolerant and partial matching
- **Search Results UI**: Dedicated search view with highlighting
- **Kanban Filtering**: Show unread/attachments only
- **Kanban Sorting**: Date (newest/oldest first) and sender name

## Setup Instructions

### 1. Google Cloud Setup & OAuth Credentials

To run this project, you need to create Google OAuth credentials:

1.  Go to [Google Cloud Console](https://console.cloud.google.com/).
2.  Create a new project.
3.  **Enable Gmail API**: Go to "APIs & Services" > "Library", search for "Gmail API" and enable it.
4.  **Configure OAuth Consent Screen**:
    - Go to "APIs & Services" > "OAuth consent screen".
    - User Type: **External** (or Internal if you have a Workspace).
    - Scopes: Add `.../auth/gmail.readonly`, `.../auth/gmail.modify`, `.../auth/gmail.send`, `email`, `profile`.
    - Test Users: Add your email address (required for External app in testing mode).
5.  **Create Credentials**:
    - Go to "APIs & Services" > "Credentials".
    - Click "Create Credentials" > "OAuth client ID".
    - Application type: **Web application**.
    - Name: `AI Email Box Local`.
    - **Authorized JavaScript origins**: `http://localhost:3000`
    - **Authorized redirect URIs**: `http://localhost:3000` (The frontend handles the callback).
    - Copy the **Client ID** and **Client Secret**.

### 2. Setup MongoDB

**Option A: Local MongoDB**

```bash
# Install MongoDB Community Edition
# Start MongoDB service
mongod --dbpath /path/to/data/db
```

**Option B: MongoDB Atlas (Cloud)** _(Recommended)_

1.  Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2.  Create a free cluster
3.  Whitelist your IP address (or allow all: `0.0.0.0/0` for development)
4.  Create a database user
5.  Get connection string: `mongodb+srv://username:password@cluster.mongodb.net/`

### 3. Start Backend

```bash
cd AiEmailbox-BE-GO

# Create .env file
cp .env.example .env

# Update .env with your credentials:
# PORT=8080
# MONGODB_URI=mongodb://localhost:27017  # or MongoDB Atlas URI
# MONGODB_DATABASE=aiemailbox
# GOOGLE_CLIENT_ID=<your-google-client-id>
# GOOGLE_CLIENT_SECRET=<your-google-client-secret>
# FRONTEND_URL=http://localhost:3000
# JWT_SECRET=<random-secret-string>
# JWT_ACCESS_EXPIRATION=15m
# JWT_REFRESH_EXPIRATION=168h

# Run server
go run -mod=vendor cmd/server/main.go
```

Backend runs on `http://localhost:8080`

API documentation available at: `http://localhost:8080/swagger/index.html`

### 4. Start Frontend

```bash
cd AiEmailbox-FE

# Install dependencies
npm install

# Create .env file
cp .env.example .env

# Update .env:
# NEXT_PUBLIC_API_URL=http://localhost:8080/api
# NEXT_PUBLIC_GOOGLE_CLIENT_ID=<your-google-client-id>  # Same as backend

# Run development server
npm run dev
```

Frontend runs on `http://localhost:3000`

## Architecture Overview

### Kanban Workflow (GA5)

- **Status Management**: Emails organized into workflow columns (Inbox, To Do, In Progress, Done, Snoozed)
- **Drag-and-Drop**: Intuitive card movement between columns with optimistic UI updates
- **Snooze Mechanism**: Temporary email deferral with automatic restoration via background job
- **AI Summarization**: LLM-powered content summaries with toggle view and persistent caching

### Search & Filtering (GA6)

- **Fuzzy Search**: Typo-tolerant matching using Levenshtein distance and accent normalization
- **Search Results**: Dedicated view with query highlighting and pagination support
- **Kanban Filters**: Real-time filtering by read status and attachment presence
- **Kanban Sorting**: Flexible sorting by date (newest/oldest) or sender name

**Kanban Data Flow**:
1. Frontend calls `kanbanService.getKanban()` to fetch emails grouped by status
2. Backend queries Gmail API and organizes emails into columns based on labels
3. Drag-and-drop triggers `kanbanService.moveCard(emailId, newStatus)`
4. Backend updates Gmail label for that email
5. Frontend optimistically updates UI, then refreshes on success

**Search Data Flow**:
1. User types query in search bar
2. Frontend calls `emailService.searchEmails(query)`
3. Backend performs fuzzy matching with Levenshtein distance
4. Results ranked by relevance and returned with highlighted matches
5. Frontend displays results with query highlighting

## Project Structure

```
.ai-emailbox-final-project/
├── AiEmailbox-BE-GO/              # Backend (Go)
│   ├── cmd/server/                # Application entry point
│   │   └── main.go                # Server setup and routing
│   ├── config/                    # Configuration management
│   │   └── config.go              # Environment variables
│   ├── internal/
│   │   ├── database/              # Database connection
│   │   │   └── mongodb.go
│   │   ├── handlers/              # HTTP request handlers
│   │   │   ├── auth.go            # Authentication endpoints
│   │   │   ├── email.go           # Email & Search endpoints (GA6)
│   │   │   └── kanban.go          # Kanban workflow endpoints
│   │   ├── middleware/            # HTTP middleware
│   │   │   ├── auth.go            # JWT verification
│   │   │   └── cors.go            # CORS configuration
│   │   ├── models/                # Data models
│   │   │   ├── email.go           # Email structures
│   │   │   └── user.go            # User structures
│   │   ├── repository/            # Database layer
│   │   │   ├── email_repository.go
│   │   │   └── user_repository.go
│   │   ├── services/              # Business logic
│   │   │   ├── gmail_service.go     # Gmail API integration
│   │   │   ├── summary_service.go   # AI summarization
│   │   │   └── snooze_worker.go     # Background job
│   │   └── utils/                 # Helper functions
│   │       ├── jwt.go               # JWT utilities
│   │       ├── password.go          # Password hashing
│   │       └── string.go            # String utilities (Levenshtein, accents)
│   ├── docs/                      # Swagger documentation
│   ├── .env                       # Environment variables
│   └── go.mod                     # Go dependencies
│
└── AiEmailbox-FE/                 # Frontend (Next.js)
   ├── src/
   │   ├── app/                   # Next.js app router
   │   │   ├── components/        # Page-specific components
   │   │   │   ├── EmailDetail.tsx
   │   │   │   └── Kanban/        # Kanban view components
   │   │   │       ├── KanbanBoard.tsx    # Main board
   │   │   │       ├── KanbanColumn.tsx   # Column component
   │   │   │       └── KanbanCard.tsx     # Card with snooze & summarize
   │   │   ├── inbox/             # Inbox page
   │   │   │   └── page.tsx       # List/Kanban toggle
   │   │   ├── login/             # Login page
   │   │   │   └── page.tsx
   │   │   ├── layout.tsx         # Root layout
   │   │   └── page.tsx           # Home page
   │   ├── components/            # Shared components
   │   │   ├── ComposeModal.tsx   # Email composition
   │   │   └── ProtectedRoute.tsx # Auth guard
   │   ├── contexts/              # React contexts
   │   │   └── AuthContext.tsx    # Authentication state
   │   ├── services/              # API services
   │   │   ├── api.ts             # Axios client with interceptors
   │   │   ├── auth.ts            # Auth API calls
   │   │   ├── email.ts           # Email & Search API (GA6)
   │   │   └── kanbanService.ts   # Kanban API calls
   │   ├── types/                 # TypeScript types
   │   │   ├── auth.ts
   │   │   └── email.ts
   │   └── mocks/                 # Mock data (for development)
   ├── public/                    # Static assets
   ├── .env                       # Environment variables
   ├── package.json               # Node dependencies
   └── tsconfig.json              # TypeScript config
```

## Quick Start Guide

1.  **Setup Google Cloud credentials** (see section 1 above)
2.  **Start MongoDB** (local or Atlas)
3.  **Configure backend** `.env` with Google credentials
4.  **Start backend**: `cd AiEmailbox-BE-GO && go run -mod=vendor cmd/server/main.go`
5.  **Configure frontend** `.env` with API URL and Google Client ID
6.  **Start frontend**: `cd AiEmailbox-FE && npm install && npm run dev`
7.  **Navigate to** `http://localhost:3000`
8.  **Login with Google** and grant permissions
9.  **Try features**:
    - Search for emails with typos (e.g., "markting")
    - Toggle to Kanban view
    - Filter by unread/attachments
    - Sort by date or sender
    - Drag cards between columns
    - Snooze emails
    - Generate AI summaries

## Feature Implementation Details (GA6)

### F1 - Fuzzy Search Engine (Backend)

**Implementation**: Advanced search algorithm with typo tolerance and partial matching capabilities.

**Search Strategy**:
1. **Primary Search**: Gmail API search with exact matching
2. **Secondary Search**: MongoDB regex search for local results
3. **Fuzzy Fallback**: Levenshtein distance algorithm for typo tolerance

**Technical Details**:

**Typo Tolerance**:
- Uses Levenshtein distance algorithm to find similar strings
- Threshold: 3 character differences allowed
- Example: "marketing" matches "markting", "markeitng"

**Accent Normalization**:
- Vietnamese accent support: "Nguyễn" matches "Nguyen"
- Uses Unicode normalization (NFD) and rune removal
- Regex patterns for relaxed character matching

**Partial Matching**:
- Searches in: subject, sender name, sender email, summary, body
- Case-insensitive matching
- Query: "Nguy" matches "Nguyễn Văn A", "nguyen@example.com"

**Ranking**:
- Gmail results first (exact matches)
- MongoDB regex matches second
- Fuzzy matches last
- Deduplicated by email ID

**Files**:
- `AiEmailbox-BE-GO/internal/handlers/email.go` - SearchEmails handler
- `AiEmailbox-BE-GO/internal/repository/email_repository.go` - SearchEmails with regex
- `AiEmailbox-BE-GO/internal/utils/string.go` - Levenshtein distance & RemoveAccents
- `AiEmailbox-BE-GO/internal/services/gmail_service.go` - Gmail API integration

### F2 - Fuzzy Search UI (Frontend)

**Implementation**: Dedicated search interface with real-time results and query highlighting.

**Features**:

**Search Bar**:
- Prominent placement in header (always visible)
- Enter key triggers search
- Loading indicator during request
- Search icon visual cue

**Search Results View**:
- Dedicated full-screen results panel
- Replaces main inbox view when active
- Clear "Back" button to return to inbox
- Result count display: "Showing X/Y" with total estimate

**Result Cards**:
- Reuses existing email card component for consistency
- Displays: sender name, subject, preview/summary
- Star indicator and attachment icon
- Formatted receive date
- Click opens full email detail in modal

**Query Highlighting**:
- Highlights matched text in yellow background
- Fuzzy matching: highlights similar characters even with accents
- Example: Query "nguyen" highlights "Nguyễn", "Nguyen"
- Uses custom HighlightText component with regex matching

**Pagination**:
- "Load More" button when more results available
- Displays "Showing X/Y" where Y is total estimate
- Smooth loading state with spinner

**UX States**:
- **Loading**: "Loading..." text with centered spinner
- **Empty**: "No emails found matching your query" with icon
- **Error**: Error message with retry option
- **Clear Search**: "Back" button or close icon to exit search view

**Files**:
- `AiEmailbox-FE/src/app/components/SearchInput.tsx` - Search bar component
- `AiEmailbox-FE/src/app/components/SearchResults.tsx` - Results view with highlighting
- `AiEmailbox-FE/src/app/inbox/page.tsx` - Search state management
- `AiEmailbox-FE/src/services/email.ts` - searchEmails API call

### F3 - Filtering & Sorting on Kanban Board

**Implementation**: Real-time controls for customizing Kanban board view.

**Sorting Controls**:

**Date: Newest First** (default)
- Sorts by received_at descending
- Most recent emails appear at top

**Date: Oldest First**
- Sorts by received_at ascending
- Oldest emails appear at top

**Sender Name**
- Alphabetical sorting by sender name
- Case-insensitive

**UI**:
- Dropdown select in board header
- Applies to all columns simultaneously
- Smooth transition when changing sort

**Filtering Controls**:

**Show only Unread**
- Checkbox filter with blue highlight when active
- Filters cards with is_read: false
- Works across all columns

**Show only with Attachments**
- Checkbox filter with blue highlight when active
- Filters cards with has_attachments: true
- Useful for finding important emails with files

**Multiple Filters**:
- Filters can be combined (AND logic)
- Example: Unread emails with attachments
- Filter count updates in real-time

**UI Design**:
- Filter bar above board columns
- Filter icon visual indicator
- Checkboxes with custom styling
- Blue accent for active filters
- Responsive layout with wrapping

**Real-time Update**:
- No page reload required
- Instant visual feedback
- Uses React useMemo for performance
- Preserves scroll position

**Technical Details**:
- State management via React useState
- processedColumns useMemo for efficient filtering/sorting
- Filter/sort logic applied before rendering
- Preserves drag-and-drop functionality

**Files**:
- `AiEmailbox-FE/src/app/components/Kanban/KanbanBoard.tsx` - Filtering/sorting logic and UI controls

## Tech Stack

### Backend

- **Framework**: Go (Golang) with Gin web framework
- **Database**: MongoDB (Cloud: MongoDB Atlas)
- **Authentication**: JWT with refresh token rotation
- **Gmail Integration**: Google API Client for Go
- **Search**: Levenshtein distance, Unicode normalization, Regex
- **AI**: OpenAI/Gemini integration (configurable)
- **API Documentation**: Swagger/OpenAPI

### Frontend

- **Framework**: Next.js 15 (App Router)
- **UI Library**: React 19
- **Language**: TypeScript
- **Components**: Ant Design (antd)
- **Drag & Drop**: @dnd-kit (core, sortable, utilities)
- **HTTP Client**: Axios with interceptors
- **Styling**: Tailwind CSS + Custom CSS
- **Date Handling**: dayjs
- **OAuth**: @react-oauth/google

### DevOps & Deployment

- **Frontend Hosting**: Vercel
- **Backend Hosting**: Render
- **Database**: MongoDB Atlas (Cloud)

### Key Dependencies

**Frontend** (`AiEmailbox-FE/package.json`):

```json
{
  "@dnd-kit/core": "^6.3.1", // Drag-and-drop core
  "@dnd-kit/sortable": "^10.0.0", // Sortable containers
  "@dnd-kit/utilities": "^3.2.2", // DnD utilities
  "antd": "^5.29.1", // UI components
  "axios": "^1.13.2", // HTTP client
  "dayjs": "^1.11.19", // Date/time handling
  "next": "16.0.3", // React framework
  "react": "19.2.0", // UI library
  "@react-oauth/google": "^0.12.2" // Google OAuth
}
```

**Backend** (`AiEmailbox-BE-GO/go.mod`):

```go
github.com/gin-gonic/gin              // Web framework
go.mongodb.org/mongo-driver           // MongoDB driver
github.com/golang-jwt/jwt             // JWT tokens
google.golang.org/api/gmail/v1        // Gmail API
github.com/joho/godotenv              // Environment variables
github.com/swaggo/gin-swagger         // API documentation
```

## API Endpoints (Swagger)

Full API documentation available at: `http://localhost:8080/swagger/index.html`

**Key Endpoints**:
- `POST /api/auth/google` - Google OAuth login
- `GET /api/mailboxes` - List Gmail mailboxes
- `GET /api/mailboxes/:id/emails` - List emails
- `GET /api/emails/search?q=query` - Fuzzy search (GA6)
- `GET /api/kanban` - Get Kanban board
- `POST /api/kanban/move` - Move card between columns
- `POST /api/kanban/snooze` - Snooze email
- `POST /api/kanban/summarize` - Generate AI summary

---

**Advanced Web Development Course**

---
