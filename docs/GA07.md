# AI Email Box - React Email Client with Gmail Integration & Kanban Workflow

A modern, secure email dashboard application that integrates with **Gmail API** (Track A) to provide a real-time email experience with **Kanban-style workflow management**. Built with **Go (Gin)** backend and **Next.js** frontend, featuring AI-powered email summarization and advanced search capabilities.


## Team
- Mai XuÃ¢n QuÃ½ (22120303)
- LÃª HoÃ ng Viá»‡t (22120430)
- TrÆ°Æ¡ng LÃª Anh VÅ© (22120443)

## Deployed Public URLs

- **Frontend**: https://ai-emailbox-fe.vercel.app
- **Backend**: https://aiemailbox-be-go.onrender.com

## Project Overview

This project extends the **"React Email Client with Gmail / IMAP/POP3 Integration"** (Track A) with advanced workflow management and search features:

### Core Features (Week 1 - Track A)

- Google Cloud Project with Gmail API enabled
- OAuth2 Authentication with auto-refresh tokens
- Real-time email synchronization from Gmail
- Email list with pagination, unread/starred indicators
- Email detail view with HTML rendering and attachments
- Compose and send emails

### Kanban Workflow Features (Week 2 - GA5)

- Kanban Board Interface with visual columns (Inbox, To Do, In Progress, Done, Snoozed)
- Drag-and-Drop workflow management
- Snooze/Deferral mechanism with automatic restoration
- AI Content Summarization with toggle view
- List/Kanban view toggle

### Advanced Search & UX Features (Week 3 - GA6)

- Fuzzy Search Engine with typo-tolerance and partial matching
- Search UI with query highlighting and dedicated results view
- Kanban Filtering (unread/attachments) and Sorting (date/sender)

### Intelligent Search & Customization (Week 4 - GA7)

- **Semantic Search**: Vector-based conceptual search with embeddings (OpenAI/Gemini)
- **Auto-Suggestions**: Type-ahead search bar with sender and keyword predictions
- **Dynamic Kanban**: Customizable columns with Gmail label mapping

## Setup Instructions

### 1. Google Cloud Setup & OAuth Credentials

To run this project, you need to create Google OAuth credentials:

1.  Go to [Google Cloud Console](https://console.cloud.google.com/).
2.  Create a new project.
3.  **Enable Gmail API**: Go to "APIs & Services" > "Library", search for "Gmail API" and enable it.
4.  **Configure OAuth Consent Screen**:
    - Go to "APIs & Services" > "OAuth consent screen".
    - User Type: **External** (or Internal if you have a Workspace).
    - Scopes: Add `.../auth/gmail.readonly`, `.../auth/gmail.modify`, `.../auth/gmail.send`, `email`, `profile`.
    - Test Users: Add your email address (required for External app in testing mode).
5.  **Create Credentials**:
    - Go to "APIs & Services" > "Credentials".
    - Click "Create Credentials" > "OAuth client ID".
    - Application type: **Web application**.
    - Name: `AI Email Box Local`.
    - **Authorized JavaScript origins**: `http://localhost:3000`
    - **Authorized redirect URIs**: `http://localhost:3000` (The frontend handles the callback).
    - Copy the **Client ID** and **Client Secret**.

### 2. Setup MongoDB

**Option A: Local MongoDB**

```bash
# Install MongoDB Community Edition
# Start MongoDB service
mongod --dbpath /path/to/data/db
```

**Option B: MongoDB Atlas (Cloud)** _(Recommended)_

1.  Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2.  Create a free cluster
3.  Whitelist your IP address (or allow all: `0.0.0.0/0` for development)
4.  Create a database user
5.  Get connection string: `mongodb+srv://username:password@cluster.mongodb.net/`

### 3. Start Backend

```bash
cd AiEmailbox-BE-GO

# Create .env file
cp .env.example .env

# Update .env with your credentials:
# PORT=8080
# MONGODB_URI=mongodb://localhost:27017  # or MongoDB Atlas URI
# MONGODB_DATABASE=aiemailbox
# GOOGLE_CLIENT_ID=<your-google-client-id>
# GOOGLE_CLIENT_SECRET=<your-google-client-secret>
# FRONTEND_URL=http://localhost:3000
# JWT_SECRET=<random-secret-string>
# JWT_ACCESS_EXPIRATION=15m
# JWT_REFRESH_EXPIRATION=168h
# LLM_API_KEY=<your-llm-api-key>
# LLM_PROVIDER=openai  
# SNOOZE_CHECK_INTERVAL=1m
# KANBAN_COLUMNS=Inbox,To Do,In Progress,Done,Snoozed

# Run server
go run -mod=vendor cmd/server/main.go
```

Backend runs on `http://localhost:8080`

API documentation available at: `http://localhost:8080/swagger/index.html`

### 4. Start Frontend

```bash
cd AiEmailbox-FE

# Install dependencies
npm install

# Create .env file
cp .env.example .env

# Update .env:
# NEXT_PUBLIC_API_URL=http://localhost:8080/api
# NEXT_PUBLIC_GOOGLE_CLIENT_ID=<your-google-client-id>  # Same as backend

# Run development server
npm run dev
```

Frontend runs on `http://localhost:3000`

## Architecture Overview

### Kanban Workflow (GA5)

- **Status Management**: Emails organized into workflow columns (Inbox, To Do, In Progress, Done, Snoozed)
- **Drag-and-Drop**: Intuitive card movement between columns with optimistic UI updates
- **Snooze Mechanism**: Temporary email deferral with automatic restoration via background job
- **AI Summarization**: LLM-powered content summaries with toggle view and persistent caching

### Search & Filtering (GA6)

- Fuzzy Search with typo-tolerance (Levenshtein distance)
- Search UI with highlighting and pagination
- Kanban Filtering and Sorting

### Semantic Search & Customization (GA7)

- **Semantic Search**: AI-powered conceptual search using vector embeddings
- **Auto-Suggestions**: Real-time type-ahead with sender and keyword predictions
- **Dynamic Kanban**: User-configurable columns with Gmail label mapping

## Project Structure

```
.ai-emailbox-final-project/
â”œâ”€â”€ AiEmailbox-BE-GO/              # Backend (Go)
â”‚   â”œâ”€â”€ cmd/server/                # Application entry point
â”‚   â”‚   â””â”€â”€ main.go                # Server setup and routing
â”‚   â”œâ”€â”€ config/                    # Configuration management
â”‚   â”‚   â””â”€â”€ config.go              # Environment variables
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ database/              # Database connection
â”‚   â”‚   â”‚   â””â”€â”€ mongodb.go
â”‚   â”‚   â”œâ”€â”€ handlers/              # HTTP request handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go            # Authentication endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ email.go           # Email endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ search.go          # Semantic search & suggestions (GA7)
â”‚   â”‚   â”‚   â”œâ”€â”€ kanban.go          # Kanban workflow endpoints
â”‚   â”‚   â”‚   â””â”€â”€ kanban_config.go   # Kanban column config (GA7)
â”‚   â”‚   â”œâ”€â”€ middleware/            # HTTP middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go            # JWT verification
â”‚   â”‚   â”‚   â””â”€â”€ cors.go            # CORS configuration
â”‚   â”‚   â”œâ”€â”€ models/                # Data models
â”‚   â”‚   â”‚   â”œâ”€â”€ email.go           # Email structures with embeddings
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go            # User structures
â”‚   â”‚   â”‚   â””â”€â”€ kanban_config.go   # Column configuration (GA7)
â”‚   â”‚   â”œâ”€â”€ repository/            # Database layer
â”‚   â”‚   â”‚   â”œâ”€â”€ email_repository.go      # With embedding queries (GA7)
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository.go
â”‚   â”‚   â”‚   â””â”€â”€ kanban_config_repository.go  # Column CRUD (GA7)
â”‚   â”‚   â”œâ”€â”€ services/              # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ gmail_service.go     # Gmail API integration
â”‚   â”‚   â”‚   â”œâ”€â”€ summary_service.go   # AI summarization
â”‚   â”‚   â”‚   â”œâ”€â”€ embedding_service.go # Vector embeddings (GA7)
â”‚   â”‚   â”‚   â””â”€â”€ snooze_worker.go     # Background job
â”‚   â”‚   â””â”€â”€ utils/                 # Helper functions
â”‚   â”‚       â”œâ”€â”€ jwt.go               # JWT utilities
â”‚   â”‚       â”œâ”€â”€ password.go          # Password hashing
â”‚   â”‚       â””â”€â”€ string_utils.go      # String utilities (cosine similarity)
â”‚   â”œâ”€â”€ docs/                      # Swagger documentation
â”‚   â”œâ”€â”€ .env                       # Environment variables
â”‚   â””â”€â”€ go.mod                     # Go dependencies
â”‚
â””â”€â”€ AiEmailbox-FE/                 # Frontend (Next.js)
   â”œâ”€â”€ src/
   â”‚   â”œâ”€â”€ app/                   # Next.js app router
   â”‚   â”‚   â”œâ”€â”€ components/        # Page-specific components
   â”‚   â”‚   â”‚   â”œâ”€â”€ EmailDetail.tsx
   â”‚   â”‚   â”‚   â”œâ”€â”€ SearchInput.tsx         # Auto-suggest search (GA7)
   â”‚   â”‚   â”‚   â”œâ”€â”€ SearchResults.tsx       # Search results view
   â”‚   â”‚   â”‚   â””â”€â”€ Kanban/        # Kanban view components
   â”‚   â”‚   |   â”œâ”€â”€ KanbanBoard.tsx         # Main board with filters
   â”‚   â”‚   |   â”œâ”€â”€ KanbanColumn.tsx        # Column component
   â”‚   â”‚   |   â”œâ”€â”€ KanbanCard.tsx          # Card with snooze & summarize
   â”‚   â”‚   |   â””â”€â”€ KanbanSettingsModal.tsx # Column config (GA7)
   â”‚   â”‚   â”œâ”€â”€ inbox/             # Inbox page
   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # List/Kanban toggle
   â”‚   â”‚   â”œâ”€â”€ login/             # Login page
   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
   â”‚   â”‚   â”œâ”€â”€ layout.tsx         # Root layout
   â”‚   â”‚   â””â”€â”€ page.tsx           # Home page
   â”‚   â”œâ”€â”€ components/            # Shared components
   â”‚   â”‚   â”œâ”€â”€ ComposeModal.tsx   # Email composition
   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx # Auth guard
   â”‚   â”œâ”€â”€ contexts/              # React contexts
   â”‚   â”‚   â””â”€â”€ AuthContext.tsx    # Authentication state
   â”‚   â”œâ”€â”€ services/              # API services
   â”‚   â”‚   â”œâ”€â”€ api.ts             # Axios client with interceptors
   â”‚   â”‚   â”œâ”€â”€ auth.ts            # Auth API calls
   â”‚   â”‚   â”œâ”€â”€ email.ts           # Email API
   â”‚   â”‚   â”œâ”€â”€ searchService.ts   # Semantic search & suggestions (GA7)
   â”‚   â”‚   â””â”€â”€ kanbanService.ts   # Kanban & column config API (GA7)
   â”‚   â”œâ”€â”€ types/                 # TypeScript types
   â”‚   â”‚   â”œâ”€â”€ auth.ts
   â”‚   â”‚   â””â”€â”€ email.ts
   â”‚   â””â”€â”€ mocks/                 # Mock data (for development)
   â”œâ”€â”€ public/                    # Static assets
   â”œâ”€â”€ .env                       # Environment variables
   â”œâ”€â”€ package.json               # Node dependencies
   â””â”€â”€ tsconfig.json              # TypeScript config
```

## Quick Start Guide

1.  **Setup Google Cloud credentials** (see section 1 above)
2.  **Start MongoDB** (local or Atlas)
3.  **Configure backend** `.env` with Google credentials
4.  **Start backend**: `cd AiEmailbox-BE-GO && go run -mod=vendor cmd/server/main.go`
5.  **Configure frontend** `.env` with API URL and Google Client ID
6.  **Start frontend**: `cd AiEmailbox-FE && npm install && npm run dev`
7.  **Navigate to** `http://localhost:3000`
8.  **Login with Google** and grant permissions
9.  **Try features**:
    - **Semantic Search**: Search "money" to find emails about "invoice", "payment", "salary"
    - **Auto-Suggestions**: Type in search bar to see sender and keyword suggestions
    - **Customize Kanban**: Open Settings to create custom columns and map Gmail labels
    - Toggle to Kanban view and drag cards between columns
    - Filter by unread/attachments and sort by date or sender
    - Snooze emails and generate AI summaries

## Feature Implementation Details (GA7)

### Feature I - Semantic Search (Backend & Logic)

**Implementation**: AI-powered conceptual search using vector embeddings for intelligent email discovery.

**Embedding Generation**:
- **Providers**: Supports OpenAI (text-embedding-ada-002) and Gemini (text-embedding-004)
- **Process**: Combines email subject + body, generates 768-1536 dimension vectors
- **Storage**: Embeddings stored in MongoDB `emails` collection with `embedding` field
- **Trigger**: Batch generation endpoint `/api/search/generate-embeddings` processes up to 100 emails

**Semantic Matching**:
- **Query Vectorization**: User query converted to embedding vector
- **Similarity Calculation**: Cosine similarity between query and email embeddings
- **Conceptual Relevance**: Finds emails by meaning, not just keywords
  - Query "money" â†’ matches emails with "invoice", "payment", "salary", "budget"
  - Query "meeting schedule" â†’ matches "appointment", "calendar invite", "time slot"

**Ranking & Results**:
- Results sorted by cosine similarity score (0.0 - 1.0)
- Higher scores = more semantically relevant
- Default limit: 10 results, max 50
- Deduplication by email ID

**API Endpoint**: `POST /api/search/semantic`
```json
{
  "query": "budget approval",
  "limit": 10
}
// Response:
{
  "results": [
    {"email": {...}, "score": 0.89},
    {"email": {...}, "score": 0.76}
  ],
  "query": "budget approval",
  "total": 15
}
```

**Technical Stack**:
- **Embedding Model**: OpenAI text-embedding-ada-002 or Gemini text-embedding-004
- **Vector Similarity**: Cosine similarity algorithm
- **Dimension**: 768 (Gemini) or 1536 (OpenAI)

**Files**:
- AiEmailbox-BE-GO/internal/handlers/search.go - `SemanticSearch` handler
- AiEmailbox-BE-GO/internal/services/embedding_service.go - OpenAI/Gemini integration
- AiEmailbox-BE-GO/internal/repository/email_repository.go - Embedding storage queries
- AiEmailbox-BE-GO/internal/utils/string_utils.go - `CosineSimilarity` function

---

### Feature II - Search Auto-Suggestion (UI & Interaction)

**Implementation**: Real-time type-ahead search with intelligent suggestions from email data.

**Suggestion Sources**:
1. **Sender Names**: Unique sender names matching query prefix (limit 3)
2. **Keywords**: Subject line keywords matching query (limit 2)
3. **Total**: Maximum 5 suggestions displayed

**Auto-Suggest Behavior**:
- **Trigger**: Activates after user types 2+ characters
- **Debouncing**: 300ms delay to reduce API calls
- **Loading State**: Blue search icon during fetch
- **Dropdown**: Appears below input with icon indicators
  - ğŸ‘¤ User icon = Sender suggestion 
  - ğŸ·ï¸ Tag icon = Keyword suggestion

**User Interaction**:
- **Click Suggestion**: Auto-fills search bar and triggers semantic search
- **Enter Key**: Submits current input value for search
- **Empty State**: No suggestions shown if query < 2 chars
- **Error Handling**: Silent fail, empty suggestions on error

**UI Components**:
- **AutoComplete**: Ant Design component with custom styling
- **Rounded Input**: 40px height, 20px border radius
- **Icon Feedback**: Color changes during loading (gray â†’ blue)
- **Clear Button**: Built-in clear icon to reset input

**API Endpoint**: `GET /api/search/suggestions?q=query`
```json
// Response:
{
  "suggestions": [
    {"text": "John Doe", "type": "sender"},
    {"text": "meeting", "type": "keyword"},
    {"text": "invoice", "type": "keyword"}
  ]
}
```

**Files**:
- AiEmailbox-FE/src/app/components/SearchInput.tsx - Auto-suggest UI component
- AiEmailbox-FE/src/services/searchService.ts - `getSuggestions` API call
- AiEmailbox-BE-GO/internal/handlers/search.go - `GetSuggestions` handler
- AiEmailbox-BE-GO/internal/repository/email_repository.go - Sender/keyword aggregation

---

### Feature III - Dynamic Kanban Configuration

**Implementation**: User-customizable Kanban board with persistent column management and Gmail label mapping.

**Column Customization**:
- **Create Columns**: Add custom columns with user-defined labels
- **Rename Columns**: Edit display names for existing columns
- **Delete Columns**: Remove non-default columns (default columns protected)
- **Reorder Columns**: Drag-and-drop to change column sequence
- **Color Coding**: Optional color assignment for visual distinction

**Gmail Label Mapping**:
- **Label Selection**: Map each column to a Gmail label (INBOX, STARRED, IMPORTANT, or user labels)
- **Automatic Labeling**: Moving card to column applies corresponding Gmail label
- **Bi-directional Sync**: Gmail label changes reflected in Kanban board
- **Example Mappings**:
  - "To Do" column â†’ "STARRED" label
  - "Urgent" column â†’ "IMPORTANT" label
  - "Review" column â†’ Custom user label "NeedsReview"

**Settings Interface**:
- **Modal Design**: Dedicated settings modal accessible from Kanban board header
- **Column List**: Sortable list with drag handles (@dnd-kit)
- **Action Buttons**: Edit/Delete buttons for each column (with confirmation)
- **Add Column Form**: Input fields for label, Gmail label, and color
- **Gmail Label Dropdown**: Fetched from user's Gmail account

**Data Flow**:
1. User opens Settings â†’ Fetches columns from `GET /api/kanban/columns`
2. User creates column â†’ `POST /api/kanban/columns` â†’ Saves to DB
3. User renames column â†’ `PUT /api/kanban/columns/:id` â†’ Updates DB
4. User drags to reorder â†’ `POST /api/kanban/columns/reorder` â†’ Updates order field
5. User deletes column â†’ `DELETE /api/kanban/columns/:id` â†’ Removes from DB
6. Card moved to column â†’ `POST /api/kanban/move` â†’ Applies column's Gmail label

**API Endpoints**:
- `GET /api/kanban/columns` - Fetch user's columns
- `POST /api/kanban/columns` - Create new column
- `PUT /api/kanban/columns/:id` - Update column
- `DELETE /api/kanban/columns/:id` - Delete column
- `POST /api/kanban/columns/reorder` - Update column order
- `GET /api/gmail/labels` - Fetch Gmail labels for mapping

**Technical Details**:
- **Drag-and-Drop**: @dnd-kit with vertical sorting strategy
- **State Management**: React useState with optimistic UI updates
- **Validation**: Labels required, Gmail label optional, default columns protected
- **Error Handling**: Toast messages for success/failure feedback

**Files**:
- AiEmailbox-FE/src/app/components/Kanban/KanbanSettingsModal.tsx - Settings UI component
- AiEmailbox-FE/src/services/kanbanService.ts - Column CRUD API calls
- AiEmailbox-BE-GO/internal/handlers/kanban_config.go - Column configuration handlers
- AiEmailbox-BE-GO/internal/repository/kanban_config_repository.go - Database operations
- AiEmailbox-BE-GO/internal/models/kanban_config.go - Data models

## Tech Stack

### Backend

- **Framework**: Go (Golang) with Gin web framework
- **Database**: MongoDB (Cloud: MongoDB Atlas) with vector storage
- **Authentication**: JWT with refresh token rotation
- **Gmail Integration**: Google API Client for Go
- **Semantic Search**: OpenAI/Gemini Embedding APIs, Cosine Similarity (GA7)
- **AI**: OpenAI/Gemini integration for summarization and embeddings
- **API Documentation**: Swagger/OpenAPI

### Frontend

- **Framework**: Next.js 15 (App Router)
- **UI Library**: React 19
- **Language**: TypeScript
- **Components**: Ant Design (antd)
- **Drag & Drop**: @dnd-kit (core, sortable, utilities)
- **HTTP Client**: Axios with interceptors
- **Styling**: Tailwind CSS + Custom CSS
- **Date Handling**: dayjs
- **OAuth**: @react-oauth/google

### DevOps & Deployment

- **Frontend Hosting**: Vercel
- **Backend Hosting**: Render
- **Database**: MongoDB Atlas (Cloud)

### Key Dependencies

**Frontend** (`AiEmailbox-FE/package.json`):

```json
{
  "@dnd-kit/core": "^6.3.1", // Drag-and-drop core
  "@dnd-kit/sortable": "^10.0.0", // Sortable containers
  "@dnd-kit/utilities": "^3.2.2", // DnD utilities
  "antd": "^5.29.1", // UI components
  "axios": "^1.13.2", // HTTP client
  "dayjs": "^1.11.19", // Date/time handling
  "next": "16.0.3", // React framework
  "react": "19.2.0", // UI library
  "@react-oauth/google": "^0.12.2" // Google OAuth
}
```

**Backend** (`AiEmailbox-BE-GO/go.mod`):

```go
github.com/gin-gonic/gin              // Web framework
go.mongodb.org/mongo-driver           // MongoDB driver
github.com/golang-jwt/jwt             // JWT tokens
google.golang.org/api/gmail/v1        // Gmail API
github.com/joho/godotenv              // Environment variables
github.com/swaggo/gin-swagger         // API documentation
```

## API Endpoints (Swagger)

Full API documentation available at: `http://localhost:8080/swagger/index.html`

**Key Endpoints**:

**Authentication**:
- `POST /api/auth/google` - Google OAuth login
- `POST /api/auth/refresh` - Refresh access token

**Email Management**:
- `GET /api/mailboxes` - List Gmail mailboxes
- `GET /api/mailboxes/:id/emails` - List emails with pagination

**Semantic Search (GA7)**:
- `POST /api/search/semantic` - Vector-based conceptual search
- `GET /api/search/suggestions?q=query` - Auto-complete suggestions
- `POST /api/search/generate-embeddings` - Generate email embeddings

**Kanban Workflow**:
- `GET /api/kanban` - Get Kanban board grouped by status
- `POST /api/kanban/move` - Move card between columns
- `POST /api/kanban/snooze` - Snooze email until specific time
- `POST /api/kanban/summarize` - Generate AI summary

**Dynamic Kanban Config (GA7)**:
- `GET /api/kanban/columns` - Get user's custom columns
- `POST /api/kanban/columns` - Create new column
- `PUT /api/kanban/columns/:id` - Update column (rename, color, label)
- `DELETE /api/kanban/columns/:id` - Delete custom column
- `POST /api/kanban/columns/reorder` - Reorder columns
- `GET /api/gmail/labels` - Fetch Gmail labels for mapping

---

**Advanced Web Development Course**

---
